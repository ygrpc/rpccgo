// Code generated by protoc-gen-rpc-cgo. DO NOT EDIT.

//go:build cgo

package main

/*
#include "ygrpc_cgo_common.h"
*/
import "C"

import (
	"unsafe"
	"github.com/ygrpc/rpccgo/rpcruntime"
)

//export Ygrpc_Free
func Ygrpc_Free(ptr unsafe.Pointer) {
	C.free(ptr)
}

//export Ygrpc_SetProtocol
func Ygrpc_SetProtocol(protocol int) uint64 {
	switch protocol {
	case 0:
		rpcruntime.ClearDefaultProtocol()
		return 0
	case 1:
		if err := rpcruntime.SetDefaultProtocol(rpcruntime.ProtocolGrpc); err != nil {
			return uint64(rpcruntime.StoreError(err))
		}
		return 0
	case 2:
		if err := rpcruntime.SetDefaultProtocol(rpcruntime.ProtocolConnectRPC); err != nil {
			return uint64(rpcruntime.StoreError(err))
		}
		return 0
	default:
		return uint64(rpcruntime.StoreError(rpcruntime.ErrUnknownProtocol))
	}
}

//export Ygrpc_GetErrorMsg
func Ygrpc_GetErrorMsg(errorID uint64, msgPtr *unsafe.Pointer, msgLen *int, msgFree *unsafe.Pointer) uint64 {
	msg, ok := rpcruntime.GetErrorMsgBytes(uint64(errorID))
	if !ok {
		return 1
	}
	if len(msg) == 0 {
		*msgPtr = nil
		*msgLen = 0
		*msgFree = nil
		return 0
	}
	buf := C.CBytes(msg)
	*msgPtr = buf
	*msgLen = len(msg)
	*msgFree = (unsafe.Pointer)(C.Ygrpc_Free)
	return 0
}
