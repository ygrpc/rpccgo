// Code generated by protoc-gen-rpc-cgo. DO NOT EDIT.
//
// source: unary.proto

package main

import (
	grpc "github.com/ygrpc/rpccgo/cgotest/grpc"
	rpcruntime "github.com/ygrpc/rpccgo/rpcruntime"
	proto "google.golang.org/protobuf/proto"
	unsafe "unsafe"
)

/*
#include "ygrpc_cgo_common.h"

*/
import "C"

//export Ygrpc_TestService_Ping
func Ygrpc_TestService_Ping(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	req := &grpc.PingRequest{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_Ping(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}

//export Ygrpc_TestService_Ping_TakeReq
func Ygrpc_TestService_Ping_TakeReq(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	reqFree C.FreeFunc,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	if reqFree != nil {
		C.call_free_func(reqFree, reqPtr)
	}

	req := &grpc.PingRequest{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_Ping(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}

//export Ygrpc_TestService_Ping_Native
func Ygrpc_TestService_Ping_Native(
	req_msg *C.char,
	req_msg_len C.int,
	resp_msg **C.char,
	resp_msg_len *C.int,
	resp_msg_free *C.FreeFunc,
) C.int {
	req := &grpc.PingRequest{}
	req.Msg = C.GoStringN(req_msg, req_msg_len)

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_Ping(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	if len(resp.Msg) > 0 {
		buf := C.CBytes([]byte(resp.Msg))
		*resp_msg = (*C.char)(buf)
		*resp_msg_len = C.int(len(resp.Msg))
		*resp_msg_free = (C.FreeFunc)(C.Ygrpc_Free)
	} else {
		*resp_msg = nil
		*resp_msg_len = 0
		*resp_msg_free = nil
	}
	return 0
}

//export Ygrpc_TestService_Ping_Native_TakeReq
func Ygrpc_TestService_Ping_Native_TakeReq(
	req_msg *C.char,
	req_msg_len C.int,
	req_msg_free C.FreeFunc,
	resp_msg **C.char,
	resp_msg_len *C.int,
	resp_msg_free *C.FreeFunc,
) C.int {
	req := &grpc.PingRequest{}
	req.Msg = C.GoStringN(req_msg, req_msg_len)
	if req_msg_free != nil {
		C.call_free_func(req_msg_free, unsafe.Pointer(req_msg))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_Ping(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	if len(resp.Msg) > 0 {
		buf := C.CBytes([]byte(resp.Msg))
		*resp_msg = (*C.char)(buf)
		*resp_msg_len = C.int(len(resp.Msg))
		*resp_msg_free = (C.FreeFunc)(C.Ygrpc_Free)
	} else {
		*resp_msg = nil
		*resp_msg_len = 0
		*resp_msg_free = nil
	}
	return 0
}

//export Ygrpc_TestService_PingOpt1_TakeReq
func Ygrpc_TestService_PingOpt1_TakeReq(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	reqFree C.FreeFunc,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	if reqFree != nil {
		C.call_free_func(reqFree, reqPtr)
	}

	req := &grpc.PingRequestOpt1{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_PingOpt1(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}

//export Ygrpc_TestService_PingOpt1_Native_TakeReq
func Ygrpc_TestService_PingOpt1_Native_TakeReq(
	req_msg *C.char,
	req_msg_len C.int,
	req_msg_free C.FreeFunc,
	resp_msg **C.char,
	resp_msg_len *C.int,
	resp_msg_free *C.FreeFunc,
) C.int {
	req := &grpc.PingRequestOpt1{}
	req.Msg = C.GoStringN(req_msg, req_msg_len)
	if req_msg_free != nil {
		C.call_free_func(req_msg_free, unsafe.Pointer(req_msg))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_PingOpt1(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	if len(resp.Msg) > 0 {
		buf := C.CBytes([]byte(resp.Msg))
		*resp_msg = (*C.char)(buf)
		*resp_msg_len = C.int(len(resp.Msg))
		*resp_msg_free = (C.FreeFunc)(C.Ygrpc_Free)
	} else {
		*resp_msg = nil
		*resp_msg_len = 0
		*resp_msg_free = nil
	}
	return 0
}

//export Ygrpc_TestService_PingOpt2
func Ygrpc_TestService_PingOpt2(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	req := &grpc.PingRequestOpt2{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_PingOpt2(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}

//export Ygrpc_TestService_NonFlat
func Ygrpc_TestService_NonFlat(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	req := &grpc.NonFlatRequest{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_NonFlat(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}

//export Ygrpc_TestService_NonFlat_TakeReq
func Ygrpc_TestService_NonFlat_TakeReq(
	reqPtr unsafe.Pointer,
	reqLen C.int,
	reqFree C.FreeFunc,
	respPtr *unsafe.Pointer,
	respLen *C.int,
	respFree *C.FreeFunc,
) C.int {
	reqBytes := C.GoBytes(reqPtr, reqLen)
	if reqFree != nil {
		C.call_free_func(reqFree, reqPtr)
	}

	req := &grpc.NonFlatRequest{}
	if err := proto.Unmarshal(reqBytes, req); err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	ctx := rpcruntime.BackgroundContext()
	resp, err := grpc.TestService_NonFlat(ctx, req)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	respBytes, err := proto.Marshal(resp)
	if err != nil {
		return C.int(rpcruntime.StoreError(err))
	}

	buf := C.CBytes(respBytes)
	*respPtr = buf
	*respLen = C.int(len(respBytes))
	*respFree = (C.FreeFunc)(C.Ygrpc_Free)
	return 0
}
